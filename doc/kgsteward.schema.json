{
  "$defs": {
    "FusekiConf": {
      "additionalProperties": true,
      "properties": {
        "server_brand": {
          "const": "fuseki",
          "description": "No description",
          "enum": [
            "fuseki"
          ],
          "title": "Fuseki brand",
          "type": "string"
        },
        "server_url": {
          "default": "http://localhost:3030",
          "description": "URL of the server. The SPARL endpoint is different and server specific.",
          "title": "Server URL",
          "type": "string"
        }
      },
      "required": [
        "server_brand"
      ],
      "title": "FusekiConf",
      "type": "object"
    },
    "GraphConf": {
      "properties": {
        "name": {
          "description": "Mandatory name of a graphs record.",
          "pattern": "^[a-zA-Z]\\w{0,31}$",
          "title": "Short name of a graphs reccord",
          "type": "string"
        },
        "parent": {
          "anyOf": [
            {
              "items": {
                "type": "string"
              },
              "type": "array"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "A list of name to encode dependency between datasets.  Updating the parent datset will provoke the update of its children.",
          "title": "Parent(s) of a graphs record"
        },
        "context": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "IRI for 'context' in RDF4J/GraphDB terminology, or IRI for 'named graph' in RDF/SPARQL terminology.  If missing, contect IRI will be built by concataining `context_base_IRI` and `name`",
          "title": "Full IRI of a context/named graph"
        },
        "system": {
          "anyOf": [
            {
              "items": {
                "type": "string"
              },
              "type": "array"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "A list of system command.  This is a simple convenience provided by kgsteward which is not meant to be a replacement  for serious Make-like system as for example git/dvc.",
          "title": "UNIX system command(s)"
        },
        "file": {
          "anyOf": [
            {
              "items": {
                "type": "string"
              },
              "type": "array"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "List of files containing RDF data.  Wildcard `*` can be used. The strategy used to load these files will depends on the `use_file_server` Boolean value.  With GraphDB, if `use_file_server` is `false` there might be a maximum file size (200 MB by default (?)) and compressed files may not be supported. With `use_file_server` set to `true` these limitations are overcomed, but see the security warning described above.",
          "title": "Load RDF from file(s)"
        },
        "url": {
          "anyOf": [
            {
              "items": {
                "type": "string"
              },
              "type": "array"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "List of url from which to load RDF data",
          "title": "Load RDF from URL(s)"
        },
        "stamp": {
          "anyOf": [
            {
              "items": {
                "type": "string"
              },
              "type": "array"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "List of paths to files which last modification dates will used. The file contents are ignored. Wildcard `*` can be used.",
          "title": "Stamp file(s)"
        },
        "replace": {
          "anyOf": [
            {
              "items": {
                "additionalProperties": {
                  "type": "string"
                },
                "type": "object"
              },
              "type": "array"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Dictionary to perform string substitution in SPARQL queries from `update` list. Of uttermost interest is the `${TARGET_GRAPH_CONTEXT}` which permit to restrict updates to the current context.",
          "title": "String subtitution in SPARQL update(s)"
        },
        "update": {
          "anyOf": [
            {
              "items": {
                "type": "string"
              },
              "type": "array"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "List of files containing SPARQL update commands.  Wildcard `*`can be used.",
          "title": "SPARQL update file(s)"
        },
        "zenodo": {
          "anyOf": [
            {
              "items": {
                "type": "integer"
              },
              "type": "array"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Do not use! Fetch turtle files from zenodo.  This is a completely ad hoc command developped for ENPKG (), that will be suppressed sooner or later",
          "title": "Ignore me"
        }
      },
      "required": [
        "name"
      ],
      "title": "GraphConf",
      "type": "object"
    },
    "GraphDBConf": {
      "additionalProperties": true,
      "properties": {
        "server_brand": {
          "const": "graphdb",
          "description": "One of 'graphdb' or 'fuseki' ( 'graphdb' by default).",
          "enum": [
            "graphdb"
          ],
          "title": "GraphDB brand",
          "type": "string"
        },
        "server_url": {
          "default": "http://localhost:7200",
          "description": "URL of the server. The SPARL endpoint is different and server specific.",
          "title": "Server URL",
          "type": "string"
        },
        "username": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "The name of a user with write-access rights in the triplestore.",
          "title": "Username"
        },
        "password": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "The password of a user with write-access rights to the triplestore.  It is recommended that the value of this variable is passed trough an environment variable.  By this way the password is not stored explicitely in the config file. Alternatively `?` can be used and the password will be asked interactively at run time.",
          "title": "Password"
        },
        "prefixes": {
          "anyOf": [
            {
              "items": {
                "type": "string"
              },
              "type": "array"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "No description",
          "title": "GraphDB namespace"
        }
      },
      "required": [
        "server_brand"
      ],
      "title": "GraphDBConf",
      "type": "object"
    }
  },
  "additionalProperties": true,
  "properties": {
    "store": {
      "anyOf": [
        {
          "$ref": "#/$defs/GraphDBConf"
        },
        {
          "$ref": "#/$defs/FusekiConf"
        }
      ],
      "title": "Store"
    },
    "repository_id": {
      "description": "The name of the 'repository' (GraphDB naming) or 'dataset' (fuseki) in the triplestore.",
      "pattern": "^\\w{1,32}$",
      "title": "Repository ID",
      "type": "string"
    },
    "graphs": {
      "description": "Mandatory key to specify the content of the knowledge graph in the triplestore",
      "items": {
        "$ref": "#/$defs/GraphConf"
      },
      "required": true,
      "title": "Knowledge Graph content",
      "type": "array"
    },
    "context_base_IRI": {
      "default": "http://example.org/context/",
      "title": "Context Base Iri",
      "type": "string"
    },
    "file_server_port": {
      "anyOf": [
        {
          "type": "integer"
        },
        {
          "type": "null"
        }
      ],
      "default": 8000,
      "description": "File server port.",
      "title": "file_server_port"
    },
    "use_file_server": {
      "anyOf": [
        {
          "type": "boolean"
        },
        {
          "type": "null"
        }
      ],
      "default": false,
      "description": "Boolean, `False` by default.  When set to `True`: local files will be exposed through a temporary HTTP server and loaded from it.  Support for different RDF file types and their compressed version depend on the triplstore.  The benefit is the that RDF data from `file`are processed with the same protocol as those supplied through `url`.  Essentially for GraphDB, file-size limits are suppressed and compressed formats are supported.  Beware that the used python-based server is potentially insecure (see [here](https://docs.python.org/3/library/http.server.html) for details).  This should however pose no real treat if used on a personal computer or on a server that is behind a firewall.",
      "title": "Use loccal HTTP fileserver"
    },
    "queries": {
      "default": null,
      "description": "A list of paths to files with SPARQL queries to be add to the repository user interface. Each query is first checked for syntactic correctness by being submitted to the SPARQL endpoint,  with a short timeout. The query result is not iteself checked.  Wildcard `*` can be used.",
      "items": {
        "type": "string"
      },
      "title": "GraphDB queries",
      "type": "array"
    },
    "validations": {
      "default": null,
      "description": "A list of paths to files contining SPARQL queries used to validate the repsository. Wildcard `*` can be used. By convention, a valid result should be empty, i.e. no row is returned.  Failed results should return rows permitting to diagnose the problems.",
      "items": {
        "type": "string"
      },
      "title": "Validation queries",
      "type": "array"
    }
  },
  "required": [
    "store",
    "repository_id",
    "graphs"
  ],
  "title": "KGStewardConf",
  "type": "object",
  "description": "Configuration file follows YAML syntax.      UNIX environmenent variables can be accessed anywhere in the YAML config through the `${<env-var>}` syntax.      The use of UNIX environment variables permits the portability of kgsteward config file, as local path are supplied through variables.      For security reason, kgsteward checks that every used variable exitsts and is not an empty string.      In addition, to the environment variables available at statup of kgsteward, a certain number of variables are defined at run-time:       `${}`, `${}` and `${}`.     Especially useful is `${graphs.name}` that can be used in be used in `graphs.replace` clause to indicate the current \"active\" context/named graph."
}